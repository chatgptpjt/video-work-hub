# 案件管理

案件の応募から契約、やり取り履歴の管理まで一元的に行うコマンドです。

## 使い方
```
/案件管理
```

## 機能

このコマンドは以下の5つのモードを持ちます：

### 1. 新規案件応募
- 案件URLを取得
- 応募文を自動生成
- 応募済みディレクトリに案件ファイルを作成

### 2. やり取り履歴追加
- 既存の案件ファイルを選択または案件IDを指定
- ユーザーからやり取り内容をヒアリング（日付、相手、内容）
- 案件ファイルの「やり取り履歴」セクションに追記
- ファイルが存在しない場合は新規作成を提案

### 3. 面談に移動
- 応募済みディレクトリの案件を選択
- 面談ディレクトリに移動
- 面談日時・Zoomリンクなどを記録
- ステータスを「📅 面談予定」に更新

### 4. 作業中に移動
- 応募済みまたは面談ディレクトリの案件を選択
- 作業中ディレクトリに移動
- プロジェクト進捗ステータスを追加
  - ステータス例：テスト案件中、研修中、本番稼働中、など
- 契約日、報酬などの詳細情報を追記

### 5. 完了に移動
- 作業中ディレクトリの案件を選択
- 完了ディレクトリに移動
- ステータスを「✅ 完了」に更新
- 完了日、最終成果などを記録
- CrowdWorks検収完了後、Chatwork等での直接取引に移行した案件向け

## 実行フロー

1. **モード選択**
   ```
   どの操作を行いますか？
   1. 新規案件応募（応募文作成＋ファイル作成）
   2. やり取り履歴追加（既存案件にやり取りを追記）
   3. 面談に移動（応募済み→面談ディレクトリ）
   4. 作業中に移動（応募済み/面談→作業中ディレクトリ）
   5. 完了に移動（作業中→完了ディレクトリ）
   ```

2. **各モードの処理**

   **モード1: 新規案件応募**
   - 案件URLを確認
   - WebFetchで案件詳細取得（報酬金額の税込/税抜の区別も必ず確認）
   - 申込金額を自動計算（後述の計算ルール参照）
   - プロフィールファイルを参照して応募文生成
   - 応募済みディレクトリに案件ファイル作成（案件ID_タイトル.md）

   **モード2: やり取り履歴追加**
   - 既存案件一覧を表示、または案件IDを入力
   - 以下をユーザーに確認：
     - 日付（デフォルト: 今日）
     - やり取り相手（例: クライアント、M.E.T.）
     - やり取り内容（口頭で説明してもらう）
   - 案件ファイルの「## やり取り履歴」または「## テスト案件（トライアル）の詳細やり取り」セクションに追記
   - セクションがない場合は新規作成

   **モード3: 面談に移動**
   - 応募済みディレクトリから案件を選択
   - 以下を確認：
     - 面談日時
     - Zoomリンク（あれば）
     - 注意事項・準備事項
   - ファイルに以下を追加：
     ```markdown
     | **ステータス** | 📅 **面談予定** |
     | **面談日時** | YYYY/MM/DD HH:MM |
     | **Zoomリンク** | [リンク] |

     ## 面談情報

     ### 面談日時
     - YYYY/MM/DD HH:MM〜

     ### 準備事項
     - [ ] 通信環境確認
     - [ ] Zoomアプリ最新版
     - [ ] 静かな環境確保
     ```
   - 面談ディレクトリに移動
   - 応募済みから削除

   **モード4: 作業中に移動**
   - 応募済みまたは面談ディレクトリから案件を選択
   - 以下を確認：
     - 契約日
     - 現在のステータス（テスト案件中、研修中、本番稼働中、など）
     - その他追加情報
   - ファイルに以下を追加：
     ```markdown
     | **契約日** | YYYY/MM/DD |
     | **ステータス** | 🟡 **[ステータス]** |

     ## プロジェクト進捗ステータス

     ### 現在の状態
     - [ステータス内容]

     ### 次のステップ
     1. [次のアクション]
     ```
   - 作業中ディレクトリに移動
   - 応募済みから削除

   **モード5: 完了に移動**
   - 作業中ディレクトリから案件を選択
   - 以下を確認：
     - 完了日（検収完了日）
     - 最終ステータス
     - 今後の連絡手段（Chatwork等）
   - ファイルのステータスを更新：
     ```markdown
     | **ステータス** | ✅ **完了（直接取引に移行）** |
     | **完了日** | YYYY/MM/DD |
     ```
   - 完了ディレクトリに移動

## 参照ファイル
- プロフィール: .claude/プロフィール/クラウドワークスプロフィール.md
- 案件ディレクトリ: 案件/応募済み/, 案件/面談/, 案件/作業中/, 案件/完了/

## 申込金額の計算ルール

案件の報酬金額から、CrowdWorksの申込フォームに入力する金額を自動計算する。

- 税込金額の場合: 申込金額 = round(税込金額 ÷ 1.1)
- 税抜金額の場合: 申込金額 = そのままの金額
- 税込/税抜の記載がない場合: 税込と仮定して計算し「※税込と仮定」と注記

例:
- 1,500円（税込）→ 申込金額: 1,364円
- 3,000円（税抜）→ 申込金額: 3,000円
- 3,000円（税込）→ 申込金額: 2,727円

トライアル単価と継続単価がある場合は、それぞれ計算する。

案件ファイルの報酬行の直後に申込金額行を追加する：

```markdown
| **報酬** | 1,500円/本（税込） |
| **申込金額** | 1,364円（税込 1,500円） |
```

トライアル＋継続の場合:
```markdown
| **報酬** | トライアル1,000円/本 → 継続後3,000円以上/本 |
| **申込金額** | トライアル: 909円（税込 1,000円）/ 継続: 2,727円（税込 3,000円） |
```

## 注意事項
- やり取り履歴は時系列順に記載
- 日付は YYYY/MM/DD HH:MM 形式
- 契約に進んだ案件は必ず作業中ディレクトリに移動
- ステータスは絵文字で視覚的にわかりやすく（🟡 進行中、✅ 完了、⏳ 待機中、など）

## 出力例

### やり取り履歴の追記例
```markdown
### 2026年01月22日 20:15 - クライアントからの連絡
クライアント より：
\```
テスト案件OKです！
次は本番案件をお願いします。
\```

### 2026年01月22日 20:30 - 返信
M.E.T. より：
\```
ありがとうございます！
本番案件もしっかり対応させていただきます。
\```
```

## 実装方針

1. AskUserQuestion ツールを使ってモード選択
2. 選択されたモードに応じて処理を分岐
3. 各モードで必要な情報をユーザーから収集
4. ファイル操作（Read, Edit, Write, Bash）で案件ファイルを管理
5. 処理完了後、結果をユーザーに報告
